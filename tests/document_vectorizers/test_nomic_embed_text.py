import numpy as np

from oldv.document_vectorizers.nomic_embed_text import NomicEmbedTextCore
from oldv.models import Document


def test_nomic_embed_text_core() -> None:
    expected = np.array(
        [
            -1.54074773e-01,
            -3.05323973e-02,
            -3.91380596e00,
            1.91033781e-01,
            1.32251114e-01,
            1.59331298e00,
            -5.01262769e-03,
            -9.83304739e-01,
            -3.33661586e-01,
            -1.23409247e00,
            1.07959760e-02,
            8.93060744e-01,
            6.32232070e-01,
            1.84446430e00,
            1.03474951e00,
            -1.43544888e00,
            2.34297603e-01,
            -6.74847782e-01,
            -9.76022482e-01,
            6.75246298e-01,
            -8.41915533e-02,
            -2.15075922e00,
            -1.74571916e-01,
            8.68990302e-01,
            2.10325575e00,
            -3.24625611e-01,
            -3.42161417e-01,
            1.40638947e00,
            1.47119015e-01,
            -5.01711369e-01,
            -2.70968862e-02,
            -2.48313665e-01,
            -4.93934005e-03,
            3.57669204e-01,
            8.99390042e-01,
            6.25827312e-02,
            7.42286265e-01,
            3.94222349e-01,
            3.72125924e-01,
            1.35386094e-01,
            -1.06933758e-01,
            -3.38704348e-01,
            2.73918033e-01,
            2.32132286e-01,
            1.50435328e00,
            -3.47129889e-02,
            -9.45298076e-02,
            7.13367015e-03,
            1.98017526e00,
            -1.38168943e00,
            -4.15508687e-01,
            1.22050151e-01,
            -2.21697502e-02,
            1.37219870e00,
            1.53421807e00,
            8.05839777e-01,
            1.13243806e00,
            -1.40573263e00,
            5.52497625e-01,
            7.88352311e-01,
            4.95900750e-01,
            9.96738195e-01,
            7.50541627e-01,
            1.49037838e00,
            -3.97985131e-01,
            -7.66859770e-01,
            -5.75336337e-01,
            8.09155166e-01,
            -6.23977594e-02,
            4.13774073e-01,
            1.66728282e00,
            9.67219099e-02,
            2.46034592e-01,
            3.20906013e-01,
            5.60279012e-01,
            6.38587832e-01,
            4.23978895e-01,
            1.80690438e-01,
            -2.26051509e-02,
            -2.71674395e-01,
            8.07380319e-01,
            -9.48737860e-01,
            1.26579642e00,
            -1.00922668e00,
            -7.38487720e-01,
            -1.66754854e00,
            -9.17453945e-01,
            3.45216691e-01,
            -1.70177877e00,
            -5.31104803e-01,
            1.65023661e00,
            5.66772938e-01,
            -1.21167246e-02,
            -4.24445242e-01,
            -9.28875446e-01,
            4.66634929e-01,
            -1.05070162e00,
            -3.26361135e-02,
            -4.56935585e-01,
            -2.49981567e-01,
            3.45737696e-01,
            -5.98225653e-01,
            -4.67219353e-02,
            8.92335713e-01,
            1.68795776e00,
            7.73628116e-01,
            -9.77799833e-01,
            -2.51362085e-01,
            -1.23725438e00,
            -8.68400633e-01,
            -7.54225016e-01,
            2.50194132e-01,
            -1.77022755e-01,
            3.73618424e-01,
            2.53671765e-01,
            -4.24690098e-01,
            8.59542608e-01,
            -1.82547319e00,
            3.05998445e-01,
            8.84355783e-01,
            -8.41031551e-01,
            -6.85303062e-02,
            -9.03478503e-01,
            3.72996330e-01,
            1.18294716e00,
            1.18029833e00,
            -1.80764282e00,
            -4.32861745e-01,
            5.42474568e-01,
            1.32190093e-01,
            3.10791284e-01,
            -7.53450751e-01,
            -5.89915037e-01,
            -5.63738108e-01,
            -5.92998564e-01,
            3.38521391e-01,
            -3.44184041e-01,
            -3.64511013e-01,
            1.29906392e00,
            7.68785238e-01,
            2.04179049e-01,
            2.97236472e-01,
            5.58359265e-01,
            -1.13261569e00,
            -9.26673651e-01,
            -8.65336955e-01,
            1.54909420e00,
            -1.23498940e00,
            5.72708189e-01,
            -6.71628475e-01,
            2.51758024e-02,
            9.88305807e-01,
            9.59025741e-01,
            8.41903508e-01,
            3.94746572e-01,
            -2.10198149e-01,
            -4.51465011e-01,
            5.56236684e-01,
            8.60818923e-01,
            -1.05622768e00,
            3.02111596e-01,
            -1.94485396e-01,
            -1.74655467e-01,
            2.41381198e-01,
            8.39434505e-01,
            -1.26916814e00,
            7.34228432e-01,
            1.45200014e00,
            1.05064891e-01,
            7.50559270e-01,
            -8.34213734e-01,
            -8.68711412e-01,
            8.04179788e-01,
            -7.33366311e-01,
            -4.63583201e-01,
            -1.92344189e-01,
            -2.02551767e-01,
            -6.57091081e-01,
            6.37161076e-01,
            1.42299473e-01,
            3.88259292e-01,
            -9.45445001e-01,
            1.22693881e-01,
            5.45104086e-01,
            -3.18017066e-01,
            -5.57930768e-01,
            -5.20534456e-01,
            4.77815159e-02,
            4.89572793e-01,
            -8.09690356e-01,
            -1.89815581e-01,
            3.87882054e-01,
            -1.43077111e00,
            -8.30206573e-01,
            4.62805301e-01,
            -1.38885170e-01,
            4.44215477e-01,
            3.14300507e-01,
            5.29362798e-01,
            -1.98552787e00,
            -9.30044413e-01,
            -3.64870876e-02,
            -6.24935746e-01,
            -5.32153070e-01,
            -2.90073454e-03,
            1.83680081e00,
            1.12712812e00,
            8.14586878e-01,
            8.75674129e-01,
            3.11008245e-01,
            1.53210807e00,
            -1.39143860e00,
            -1.16913509e00,
            -4.38494712e-01,
            -4.20452923e-01,
            -2.15559766e-01,
            -2.96736687e-01,
            -9.09223914e-01,
            -1.55942217e-01,
            -1.20279305e-01,
            9.58179355e-01,
            -8.51650834e-01,
            1.06822896e00,
            3.46875757e-01,
            1.38369179e00,
            -1.01818834e-02,
            -1.74329197e00,
            8.81856866e-03,
            -1.44869471e00,
            4.66713369e-01,
            -7.18313694e-01,
            -1.47349691e00,
            4.18092251e-01,
            5.69439530e-01,
            -3.90849710e-01,
            8.79260600e-01,
            1.04242635e00,
            1.56325054e00,
            -3.18090379e-01,
            -6.80193186e-01,
            -6.77244186e-01,
            7.25260496e-01,
            2.86233127e-01,
            -8.63381565e-01,
            -1.04383135e00,
            4.77427900e-01,
            3.05262625e-01,
            9.01952684e-02,
            -3.64596069e-01,
            1.74339786e-02,
            -1.14848840e00,
            -6.02160156e-01,
            -4.73539174e-01,
            3.22223902e-02,
            6.26546204e-01,
            -2.64085591e-01,
            -4.16513860e-01,
            2.76425272e-01,
            2.68547714e-01,
            -4.17885065e-01,
            5.65622687e-01,
            -2.58106542e00,
            8.68454039e-01,
            -6.02101982e-01,
            -1.10655832e00,
            7.87533104e-01,
            -1.09993744e00,
            7.76419163e-01,
            8.16915512e-01,
            -9.83446836e-01,
            2.75797307e-01,
            2.20927119e-01,
            2.16513097e-01,
            6.31066501e-01,
            -9.93759274e-01,
            -1.39989868e-01,
            5.60524940e-01,
            3.22184086e-01,
            -4.94012713e-01,
            4.25793469e-01,
            -5.72496891e-01,
            -6.93418682e-01,
            -2.76721984e-01,
            -7.82227337e-01,
            1.84328020e-01,
            2.68371135e-01,
            -2.22115546e-01,
            2.96802729e-01,
            -7.60076225e-01,
            -3.18032324e-01,
            3.10020983e-01,
            1.05196691e00,
            6.95726991e-01,
            1.57975781e00,
            2.82437414e-01,
            6.78387582e-01,
            6.12814367e-01,
            6.59052014e-01,
            -2.52755880e-01,
            -2.21629381e-01,
            -2.85485119e-01,
            -7.12150857e-02,
            1.27597904e00,
            -1.25916377e-01,
            -4.19569075e-01,
            6.01229370e-02,
            1.71114969e00,
            -4.26597476e-01,
            1.11740339e00,
            -1.03288338e-01,
            -1.05320966e00,
            1.78428960e00,
            -2.09143853e00,
            -6.40573651e-02,
            -1.24162388e00,
            9.87898886e-01,
            -4.73380029e-01,
            7.39028394e-01,
            1.58564246e00,
            4.20074165e-01,
            -8.80493045e-01,
            -1.16196692e00,
            5.87972879e-01,
            -7.35982180e-01,
            -4.59130034e-02,
            5.21735728e-01,
            7.93895662e-01,
            5.92074394e-01,
            5.39617836e-01,
            -1.09966063e00,
            -3.34888399e-01,
            2.96281427e-01,
            -9.13652301e-01,
            -9.93923485e-01,
            -3.49833935e-01,
            9.79591489e-01,
            3.26031864e-01,
            -4.39188361e-01,
            -9.90061164e-01,
            1.16270018e00,
            -1.20243341e-01,
            5.26155531e-01,
            9.14458513e-01,
            -2.82200515e-01,
            -5.03744841e-01,
            -4.39834028e-01,
            -5.17034173e-01,
            3.76117259e-01,
            -3.41637820e-01,
            5.45508146e-01,
            1.47345364e-01,
            5.88657081e-01,
            -8.52468550e-01,
            5.81026971e-01,
            1.43278554e-01,
            5.53951800e-01,
            2.52759695e-01,
            7.43852615e-01,
            2.23777220e-01,
            -1.47496831e00,
            -6.13592148e-01,
            -2.41889693e-02,
            3.28960687e-01,
            -3.30248177e-01,
            -6.73315823e-01,
            8.29656720e-01,
            6.17808521e-01,
            1.45633847e-01,
            5.91332018e-01,
            -4.17579830e-01,
            -2.10127562e-01,
            -4.91454899e-01,
            4.14289758e-02,
            7.16390848e-01,
            5.17538309e-01,
            1.55080572e-01,
            -1.10638797e00,
            -7.78267801e-01,
            1.85147986e-01,
            9.28648055e-01,
            -3.85323107e-01,
            -5.90832293e-01,
            8.46366286e-01,
            -6.40192270e-01,
            2.67724037e-01,
            7.82193542e-01,
            3.57506275e-01,
            -6.30028307e-01,
            1.56694472e-01,
            8.36837411e-01,
            3.26179147e-01,
            -5.56068420e-01,
            8.08708742e-02,
            4.91844118e-02,
            -9.80018377e-02,
            -6.80936754e-01,
            1.55535653e-01,
            -5.11330843e-01,
            -4.82651591e-01,
            1.56724274e-01,
            -1.54557198e-01,
            2.92509735e-01,
            6.45216703e-01,
            -1.63927901e00,
            1.44676030e-01,
            -2.18562484e-02,
            -1.18282497e00,
            -5.77362299e-01,
            1.95796758e-01,
            -3.60255361e-01,
            1.47159147e00,
            1.45658207e00,
            1.03953779e00,
            -1.26635671e00,
            -9.52279091e-01,
            2.60074019e-01,
            8.35864305e-01,
            -1.55250716e00,
            -2.95164406e-01,
            -2.63884030e-02,
            4.04689759e-01,
            1.77516830e00,
            2.17967033e-01,
            -3.14451963e-01,
            -8.40610027e-01,
            1.54744530e00,
            6.41275764e-01,
            5.86199939e-01,
            2.43137404e-02,
            -8.93514097e-01,
            -2.26682946e-01,
            3.26923192e-01,
            4.23708141e-01,
            2.93545514e-01,
            -5.14981866e-01,
            -5.65894008e-01,
            1.02184772e00,
            -3.72882366e-01,
            7.59377003e-01,
            8.16547096e-01,
            1.52255821e00,
            -7.99548805e-01,
            -1.30575395e00,
            -1.37827948e-01,
            -1.78143233e-01,
            2.78506327e00,
            2.01412487e00,
            -2.27188423e-01,
            -1.14231598e00,
            -1.20033294e-01,
            -4.71210986e-01,
            4.10200417e-01,
            1.00406921e00,
            2.20936909e-01,
            1.97742224e00,
            -1.15300393e00,
            1.03381419e00,
            -4.44340438e-01,
            -1.01525374e-02,
            9.72056031e-01,
            -4.45508569e-01,
            1.43340722e-01,
            -7.23087072e-01,
            1.90945476e-01,
            2.64323711e-01,
            -1.25188661e00,
            1.36472862e-02,
            3.18146087e-02,
            -1.63561121e-01,
            2.14754567e-01,
            -1.05762339e00,
            -1.19574749e00,
            -4.38932717e-01,
            -3.02229911e-01,
            -1.37417340e00,
            5.23869395e-01,
            -3.86030316e-01,
            -2.98778921e-01,
            -3.33030492e-01,
            6.07297659e-01,
            6.31271124e-01,
            6.44260049e-01,
            -1.58774996e00,
            3.70590121e-01,
            1.15042782e00,
            1.59349370e00,
            -2.63149738e-02,
            3.11612993e-01,
            -3.97398502e-01,
            1.64280921e-01,
            -6.56765848e-02,
            -5.57821691e-01,
            8.31192553e-01,
            -7.57883862e-03,
            -6.24551237e-01,
            -1.05902851e-01,
            -1.03223336e00,
            8.16050589e-01,
            -1.02816725e00,
            2.49644965e-02,
            8.69061768e-01,
            -2.56366789e-01,
            1.65026769e-01,
            7.66311288e-01,
            1.55736730e-01,
            5.26651144e-01,
            5.97137570e-01,
            -1.31532717e00,
            2.28282988e-01,
            4.88318443e-01,
            7.11373270e-01,
            -2.57506490e-01,
            -5.25662005e-01,
            9.62394118e-01,
            2.13893175e00,
            -9.75106120e-01,
            5.73125958e-01,
            -2.52111733e-01,
            -6.92182541e-01,
            1.14334404e00,
            2.57988155e-01,
            -4.15881574e-01,
            -7.49146402e-01,
            2.80441552e-01,
            -1.74235129e00,
            1.57048333e00,
            -2.96552539e-01,
            -1.23228788e00,
            6.21077657e-01,
            6.03694856e-01,
            3.33648592e-01,
            2.44838163e-01,
            -5.28957784e-01,
            -1.01982653e00,
            6.48084939e-01,
            -1.49713874e-01,
            9.82401520e-02,
            3.46517384e-01,
            5.79421043e-01,
            3.59523296e-01,
            -6.62988961e-01,
            -9.32501107e-02,
            -1.98911190e-01,
            -8.03572893e-01,
            9.57373857e-01,
            7.82140195e-01,
            -1.17447901e00,
            3.86252135e-01,
            5.16678572e-01,
            7.10006356e-01,
            -1.58854830e00,
            -1.06283879e00,
            -6.51596487e-01,
            -2.30559915e-01,
            -1.07909560e00,
            -1.31472683e00,
            -1.16697848e-02,
            4.89256471e-01,
            -7.34029472e-01,
            -1.70031238e00,
            1.06515396e00,
            1.08677173e00,
            -5.52181244e-01,
            3.55611026e-01,
            7.09149241e-01,
            -1.18907362e-01,
            -3.63648236e-01,
            -2.85327256e-01,
            3.01985502e-01,
            -3.90292525e-01,
            -6.76844776e-01,
            -9.38536704e-01,
            5.22377074e-01,
            -6.68460965e-01,
            3.81409317e-01,
            -1.13702893e-01,
            9.31442440e-01,
            -9.77873802e-02,
            -1.46623552e00,
            -4.18577820e-01,
            1.60828233e-04,
            -1.26665354e00,
            -1.33766651e-01,
            1.17399883e00,
            -3.18449825e-01,
            2.80407190e-01,
            1.29275322e-02,
            -1.70435977e00,
            8.97882938e-01,
            -7.90782630e-01,
            -5.55527747e-01,
            6.07916236e-01,
            1.22838271e00,
            -5.53210318e-01,
            -7.44020402e-01,
            1.12036633e00,
            -9.10151958e-01,
            -9.97824311e-01,
            -4.02853340e-01,
            -1.00798965e00,
            -6.66789651e-01,
            1.45066798e-01,
            1.38336396e00,
            -1.59072435e00,
            1.13664281e00,
            1.78218377e00,
            1.87315717e-01,
            9.50462878e-01,
            4.22068477e-01,
            3.53572100e-01,
            1.71882808e00,
            6.69810772e-01,
            -5.03491044e-01,
            1.95185274e-01,
            6.35076046e-01,
            -3.45005870e-01,
            9.67436790e-01,
            -4.70427908e-02,
            -4.09826159e-01,
            -1.59530115e00,
            -7.89176464e-01,
            -3.54181349e-01,
            1.13054252e00,
            5.69076538e-01,
            6.33901834e-01,
            -1.44153774e-01,
            -1.00922942e00,
            -1.14737916e00,
            -1.31109858e00,
            1.43125951e00,
            9.16334271e-01,
            -1.56953946e-01,
            -1.46569061e00,
            5.36439084e-02,
            3.70631695e-01,
            6.76345944e-01,
            4.49438661e-01,
            -6.49468452e-02,
            -7.30299592e-01,
            3.92458856e-01,
            1.39243364e00,
            3.01052123e-01,
            4.15376991e-01,
            4.54884768e-03,
            3.43315691e-01,
            -9.31129336e-01,
            9.97617483e-01,
            5.62800825e-01,
            1.27337205e00,
            1.01736212e00,
            1.73150074e00,
            1.39954460e00,
            1.10086620e00,
            -3.18551421e-01,
            -6.15928590e-01,
            -2.59178221e-01,
            2.75060743e-01,
            -6.23033404e-01,
            -1.92635202e00,
            4.65323180e-01,
            -2.45620310e-01,
            5.97565547e-02,
            -1.51576471e00,
            -5.55952191e-01,
            7.60767817e-01,
            -4.89461273e-01,
            -7.45655775e-01,
            4.44479853e-01,
            -2.10531163e00,
            3.10282052e-01,
            -3.51065159e-01,
            -4.66589212e-01,
            -6.54895782e-01,
            -1.02211964e00,
            -6.30630016e-01,
            8.72040927e-01,
            6.17854118e-01,
            5.10894954e-01,
            6.82159126e-01,
            5.53828441e-02,
            2.54218191e-01,
            -3.21674109e-01,
            -9.96218920e-01,
            7.87790179e-01,
            1.04366076e00,
            -9.97795701e-01,
            1.45962524e00,
            -4.38305229e-01,
            -1.77583838e00,
            -1.39088738e00,
            -2.95026571e-01,
            -3.48657608e-01,
            -1.36494979e-01,
            -7.14372754e-01,
            -5.95834374e-01,
            6.79476619e-01,
            -2.86415279e-01,
            2.74369627e-01,
            -9.06523287e-01,
            8.10061514e-01,
            -9.37974989e-01,
            -2.86166102e-01,
            5.13137221e-01,
            -1.80740327e-01,
            1.06125385e-01,
            -8.94599438e-01,
            3.00273597e-01,
            9.37075973e-01,
            -2.09299892e-01,
            -3.46903950e-02,
            -3.07241559e-01,
            1.46288133e00,
            3.50762039e-01,
            7.99675107e-01,
            -2.20005780e-01,
            9.14767027e-01,
            -6.23125672e-01,
            -2.35842362e-01,
            -1.43621877e-01,
            1.36351645e00,
            1.65227211e00,
            9.65196073e-01,
            -9.46331680e-01,
            -5.28539062e-01,
            -6.12347245e-01,
            4.87410761e-02,
            4.23064828e-01,
            -7.71482706e-01,
            3.56474727e-01,
            -8.54706705e-01,
            -6.37593627e-01,
            -8.61139715e-01,
            -7.40579963e-01,
            6.38059139e-01,
            -5.96466362e-01,
            6.29206240e-01,
            -1.67259708e-01,
            -1.24657178e00,
            1.16952747e-01,
            -7.60064602e-01,
            -5.45611680e-01,
            -1.61486948e00,
            3.94635350e-01,
            1.43112290e00,
            -1.11500919e-01,
            -5.46172142e-01,
            7.79797316e-01,
            1.66438556e00,
            -2.19151303e-01,
            -4.78971899e-01,
            5.65577328e-01,
            1.19398348e-02,
            -2.37075672e-01,
            -1.62775373e00,
            -9.87901539e-03,
            8.23788047e-01,
            2.28516027e-01,
            5.10512114e-01,
            1.43579423e00,
            -9.51618671e-01,
            9.81733263e-01,
            -3.42393070e-01,
            -5.15503809e-03,
            2.19549596e-01,
            5.84262013e-01,
            -6.08549774e-01,
            -1.16094756e00,
            -1.01768903e-01,
        ],
        dtype=np.float32,
    )
    core = NomicEmbedTextCore.create()
    assert np.allclose(core.vectorize(Document(content="Hello World")).vector.array, expected, atol=1e-6)
