import numpy as np

from oldv.document_vectorizers.all_minilm import AllMiniLmVectorizerCore
from oldv.models import Document


def test_all_minilm() -> None:
    expected = np.array(
        [
            -3.44772786e-02,
            3.10232472e-02,
            6.73494395e-03,
            2.61089504e-02,
            -3.93620282e-02,
            -1.60302520e-01,
            6.69240132e-02,
            -6.44146046e-03,
            -4.74504344e-02,
            1.47588439e-02,
            7.08752722e-02,
            5.55275828e-02,
            1.91933177e-02,
            -2.62513068e-02,
            -1.01095820e-02,
            -2.69404948e-02,
            2.23074220e-02,
            -2.22266205e-02,
            -1.49692625e-01,
            -1.74930543e-02,
            7.67621724e-03,
            5.43522872e-02,
            3.25441500e-03,
            3.17259245e-02,
            -8.46213996e-02,
            -2.94059850e-02,
            5.15956096e-02,
            4.81240042e-02,
            -3.31481802e-03,
            -5.82791828e-02,
            4.19692621e-02,
            2.22106446e-02,
            1.28188819e-01,
            -2.23389063e-02,
            -1.16563132e-02,
            6.29283562e-02,
            -3.28763314e-02,
            -9.12260562e-02,
            -3.11753340e-02,
            5.26995584e-02,
            4.70348336e-02,
            -8.42030644e-02,
            -3.00561897e-02,
            -2.07448583e-02,
            9.51783918e-03,
            -3.72184161e-03,
            7.34333321e-03,
            3.93242836e-02,
            9.32740122e-02,
            -3.78858577e-03,
            -5.27421311e-02,
            -5.80582172e-02,
            -6.86441176e-03,
            5.28323185e-03,
            8.28930065e-02,
            1.93627737e-02,
            6.28452981e-03,
            -1.03307664e-02,
            9.03239660e-03,
            -3.76837738e-02,
            -4.52059880e-02,
            2.40163188e-02,
            -6.94416882e-03,
            1.34916399e-02,
            1.00054905e-01,
            -7.16838613e-02,
            -2.16950774e-02,
            3.16184200e-02,
            -5.16346805e-02,
            -8.22477192e-02,
            -6.56933188e-02,
            -9.89536196e-03,
            5.81639912e-03,
            7.35544935e-02,
            -3.40502486e-02,
            2.48861443e-02,
            1.44880842e-02,
            2.64573954e-02,
            9.65677388e-03,
            3.02172843e-02,
            5.28039411e-02,
            -7.53598660e-02,
            9.89718549e-03,
            2.98368130e-02,
            1.75555758e-02,
            2.30919365e-02,
            1.93386641e-03,
            1.40020624e-03,
            -4.71759401e-02,
            -1.11943409e-02,
            -1.14201419e-01,
            -1.98119655e-02,
            4.02662158e-02,
            2.19298061e-03,
            -7.97922611e-02,
            -2.53822897e-02,
            9.44829658e-02,
            -2.89810821e-02,
            -1.45002514e-01,
            2.30977401e-01,
            2.77311858e-02,
            3.21115069e-02,
            3.10650337e-02,
            4.28328551e-02,
            6.42377660e-02,
            3.21631469e-02,
            -4.87673376e-03,
            5.56994304e-02,
            -3.75323929e-02,
            -2.15055402e-02,
            -2.83426698e-02,
            -2.88469382e-02,
            3.83530632e-02,
            -1.74686033e-02,
            5.24853021e-02,
            -7.48760328e-02,
            -3.12597416e-02,
            2.18415838e-02,
            -3.98956649e-02,
            -8.58709868e-03,
            2.69565899e-02,
            -4.84955199e-02,
            1.14699202e-02,
            2.96182074e-02,
            -2.05721539e-02,
            1.31038632e-02,
            2.88334806e-02,
            -3.19419798e-33,
            6.47820905e-02,
            -1.81301944e-02,
            5.17899580e-02,
            1.21982753e-01,
            2.87801567e-02,
            8.72200914e-03,
            -7.05211833e-02,
            -1.69072859e-02,
            4.07397151e-02,
            4.21161316e-02,
            2.54472010e-02,
            3.57462540e-02,
            -4.91448119e-02,
            2.12909048e-03,
            -1.55465342e-02,
            5.07305861e-02,
            -4.81853113e-02,
            3.58806178e-02,
            -4.06706287e-03,
            1.01724699e-01,
            -5.59700318e-02,
            -1.06810648e-02,
            1.12357847e-02,
            9.06865597e-02,
            4.23444994e-03,
            3.51386890e-02,
            -9.70283244e-03,
            -9.38651338e-02,
            9.28555429e-02,
            8.00492335e-03,
            -7.70540908e-03,
            -5.20866998e-02,
            -1.25879347e-02,
            3.26694804e-03,
            6.01351587e-03,
            7.58159114e-03,
            1.05171520e-02,
            -8.63455385e-02,
            -6.98787645e-02,
            -2.53389170e-03,
            -9.09765884e-02,
            4.68873121e-02,
            5.20764776e-02,
            7.19384290e-03,
            1.09036407e-02,
            -5.22951456e-03,
            1.39373057e-02,
            2.19683833e-02,
            3.42086256e-02,
            6.02246858e-02,
            1.16652089e-04,
            1.47319408e-02,
            -7.00891912e-02,
            2.84990016e-02,
            -2.76016667e-02,
            1.07684340e-02,
            3.48308980e-02,
            -2.24878676e-02,
            9.76905599e-03,
            7.72278681e-02,
            2.15883832e-02,
            1.14956200e-01,
            -6.80011734e-02,
            2.37609707e-02,
            -1.59839541e-02,
            -1.78269614e-02,
            6.43949211e-02,
            3.20257619e-02,
            5.02703078e-02,
            -5.91366552e-03,
            -3.37080322e-02,
            1.78402327e-02,
            1.65733229e-02,
            6.32965118e-02,
            3.46771702e-02,
            4.64734398e-02,
            9.79060978e-02,
            -6.63549965e-03,
            2.52070334e-02,
            -7.79883042e-02,
            1.69264488e-02,
            -9.45864944e-04,
            2.24719178e-02,
            -3.82532068e-02,
            9.57047865e-02,
            -5.35081048e-03,
            1.04690902e-02,
            -1.15240559e-01,
            -1.32625159e-02,
            -1.07095139e-02,
            -8.31172094e-02,
            7.32736215e-02,
            4.93922271e-02,
            -8.99436697e-03,
            -9.58455950e-02,
            3.36614709e-33,
            1.24931842e-01,
            1.93497613e-02,
            -5.82257435e-02,
            -3.59881967e-02,
            -5.07467389e-02,
            -4.56623994e-02,
            -8.26033577e-02,
            1.48194805e-01,
            -8.84211734e-02,
            6.02744147e-02,
            5.10301776e-02,
            1.03032086e-02,
            1.41214222e-01,
            3.08138710e-02,
            6.10330701e-02,
            -5.28512336e-02,
            1.36648938e-01,
            9.18990374e-03,
            -1.73252057e-02,
            -1.28486361e-02,
            -7.99534936e-03,
            -5.09800650e-02,
            -5.23506217e-02,
            7.59302452e-03,
            -1.51663274e-02,
            1.69603005e-02,
            2.12705769e-02,
            2.05580276e-02,
            -1.20028101e-01,
            1.44618489e-02,
            2.67599169e-02,
            2.53306478e-02,
            -4.27546911e-02,
            6.76839706e-03,
            -1.44585455e-02,
            4.52620015e-02,
            -9.14765298e-02,
            -1.94391105e-02,
            -1.78334899e-02,
            -5.49101196e-02,
            -5.26410788e-02,
            -1.04591185e-02,
            -5.20160608e-02,
            2.08920166e-02,
            -7.99703002e-02,
            -1.21112801e-02,
            -5.77314384e-02,
            2.31782496e-02,
            -8.03171378e-03,
            -2.59893015e-02,
            -7.99567252e-02,
            -2.07287967e-02,
            4.88176756e-02,
            -2.03891061e-02,
            -4.91766036e-02,
            1.41596645e-02,
            -6.36220053e-02,
            -7.80738005e-03,
            1.64315440e-02,
            -2.56824940e-02,
            1.33811096e-02,
            2.62487680e-02,
            9.97843966e-03,
            6.32288381e-02,
            2.67216610e-03,
            -6.58274628e-03,
            1.66318920e-02,
            3.23664583e-02,
            3.79425138e-02,
            -3.63760553e-02,
            -6.91088196e-03,
            1.59653762e-04,
            -1.63354166e-03,
            -2.72781830e-02,
            -2.80380733e-02,
            4.96814586e-02,
            -2.88672317e-02,
            -2.41804542e-03,
            1.47748906e-02,
            9.76453628e-03,
            5.79759525e-03,
            1.34861963e-02,
            5.56787988e-03,
            3.72270830e-02,
            7.23246718e-03,
            4.01561745e-02,
            8.15032497e-02,
            7.19916299e-02,
            -1.30561702e-02,
            -4.28820439e-02,
            -1.10112634e-02,
            4.89777792e-03,
            -9.22970381e-03,
            3.51914950e-02,
            -5.10350652e-02,
            -1.57143756e-08,
            -8.86243954e-02,
            2.39093229e-02,
            -1.62387248e-02,
            3.17004696e-02,
            2.72842292e-02,
            5.24688326e-02,
            -4.70709614e-02,
            -5.88474348e-02,
            -6.32082447e-02,
            4.08885144e-02,
            4.98279966e-02,
            1.06551692e-01,
            -7.45023340e-02,
            -1.24954106e-02,
            1.83706693e-02,
            3.94741073e-02,
            -2.47978996e-02,
            1.45162921e-02,
            -3.70691791e-02,
            2.00157333e-02,
            -4.85847922e-05,
            9.86651983e-03,
            2.48387605e-02,
            -5.24581410e-02,
            2.93141790e-02,
            -8.71919394e-02,
            -1.44997491e-02,
            2.60191243e-02,
            -1.87463295e-02,
            -7.62051716e-02,
            3.50432806e-02,
            1.03639521e-01,
            -2.80504879e-02,
            1.27181746e-02,
            -7.63255134e-02,
            -1.86523292e-02,
            2.49766931e-02,
            8.14453214e-02,
            6.87588751e-02,
            -6.40566126e-02,
            -8.38938281e-02,
            6.13623597e-02,
            -3.35455164e-02,
            -1.06153339e-01,
            -4.00805734e-02,
            3.25301960e-02,
            7.66248703e-02,
            -7.30162486e-02,
            3.37591657e-04,
            -4.08715867e-02,
            -7.57884979e-02,
            2.75276341e-02,
            7.46254027e-02,
            1.77173112e-02,
            9.12184790e-02,
            1.10220186e-01,
            5.69816679e-04,
            5.14633507e-02,
            -1.45513061e-02,
            3.32319960e-02,
            2.37922724e-02,
            -2.28898600e-02,
            3.89375389e-02,
            3.02067958e-02,
        ],
        dtype=np.float32,
    )

    core = AllMiniLmVectorizerCore.create()
    assert np.allclose(core.vectorize(Document(content="Hello World")).vector.array, expected, atol=1e-6)
